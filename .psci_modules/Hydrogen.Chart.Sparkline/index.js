// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
//                                                      // hydrogen // sparkline
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// | Sparkline charts
// |
// | Inline mini-charts for displaying trends.
// |
// | ## Usage
// |
// | ```purescript
// | import Hydrogen.Chart.Sparkline as Sparkline
// |
// | -- Line sparkline
// | Sparkline.sparkline 
// |   { data: [10.0, 25.0, 15.0, 30.0, 20.0]
// |   , width: 100
// |   , height: 24
// |   }
// |
// | -- With custom color
// | Sparkline.sparklineWithProps
// |   { data: values
// |   , width: 100
// |   , height: 24
// |   , strokeColor: "text-primary"
// |   , fillColor: Just "text-primary/20"
// |   }
// | ```
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_HTML_Properties from "../Halogen.HTML.Properties/index.js";
import * as Hydrogen_UI_Core from "../Hydrogen.UI.Core/index.js";
var minimum = /* #__PURE__ */ Data_Foldable.minimum(Data_Ord.ordNumber)(Data_Foldable.foldableArray);
var maximum = /* #__PURE__ */ Data_Foldable.maximum(Data_Ord.ordNumber)(Data_Foldable.foldableArray);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var foldl = /* #__PURE__ */ Data_Foldable.foldl(Data_Foldable.foldableArray);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);

// ═══════════════════════════════════════════════════════════════════════════════
//                                                               // bar sparkline
// ═══════════════════════════════════════════════════════════════════════════════
// | Bar sparkline
var sparklineBar = function (config) {
    var minVal = Data_Maybe.fromMaybe(0.0)(minimum(config.data));
    var maxVal = Data_Maybe.fromMaybe(1.0)(maximum(config.data));
    var range = (function () {
        var $20 = maxVal === minVal;
        if ($20) {
            return 1.0;
        };
        return maxVal - minVal;
    })();
    var barWidth = Data_Int.toNumber(config.width) / Data_Int.toNumber(Data_Array.length(config.data));
    var gap = barWidth * 0.2;
    var bars = Data_Array.mapWithIndex(function (i) {
        return function (val) {
            var x = Data_Int.toNumber(i) * barWidth + gap / 2.0;
            var normalizedHeight = ((val - minVal) / range) * Data_Int.toNumber(config.height);
            var y = Data_Int.toNumber(config.height) - normalizedHeight;
            return Halogen_HTML_Elements.elementNS(Hydrogen_UI_Core.svgNS)("rect")([ Halogen_HTML_Properties.attr("x")(show(x)), Halogen_HTML_Properties.attr("y")(show(y)), Halogen_HTML_Properties.attr("width")(show(barWidth - gap)), Halogen_HTML_Properties.attr("height")(show(normalizedHeight)), Halogen_HTML_Properties.attr("rx")("1"), Hydrogen_UI_Core.svgCls([ "fill-current" ]) ])([  ]);
        };
    })(config.data);
    return Halogen_HTML_Elements.elementNS(Hydrogen_UI_Core.svgNS)("svg")([ Halogen_HTML_Properties.attr("viewBox")("0 0 " + (show1(config.width) + (" " + show1(config.height)))), Halogen_HTML_Properties.attr("width")(show1(config.width)), Halogen_HTML_Properties.attr("height")(show1(config.height)) ])(bars);
};
var pointsToPath = function (points) {
    var v = Data_Array.uncons(points);
    if (v instanceof Data_Maybe.Nothing) {
        return "";
    };
    if (v instanceof Data_Maybe.Just) {
        return "M " + (show(v.value0.head.x) + (" " + (show(v.value0.head.y) + foldl(function (acc) {
            return function (p) {
                return acc + (" L " + (show(p.x) + (" " + show(p.y))));
            };
        })("")(v.value0.tail))));
    };
    throw new Error("Failed pattern match at Hydrogen.Chart.Sparkline (line 225, column 3 - line 229, column 76): " + [ v.constructor.name ]);
};
var pointsToFillPath = function (points) {
    return function (height) {
        var v = Data_Array.uncons(points);
        if (v instanceof Data_Maybe.Nothing) {
            return "";
        };
        if (v instanceof Data_Maybe.Just) {
            var linePath = pointsToPath(points);
            var lastPoint = Data_Maybe.fromMaybe(v.value0.head)(Data_Array.last(points));
            return linePath + (" L " + (show(lastPoint.x) + (" " + (show1(height) + (" L " + (show(v.value0.head.x) + (" " + (show1(height) + " Z"))))))));
        };
        throw new Error("Failed pattern match at Hydrogen.Chart.Sparkline (line 233, column 3 - line 243, column 13): " + [ v.constructor.name ]);
    };
};
var normalizeData = function (data$prime) {
    return function (width) {
        return function (height) {
            var minVal = Data_Maybe.fromMaybe(0.0)(minimum(data$prime));
            var maxVal = Data_Maybe.fromMaybe(1.0)(maximum(data$prime));
            var range = (function () {
                var $29 = maxVal === minVal;
                if ($29) {
                    return 1.0;
                };
                return maxVal - minVal;
            })();
            var len = Data_Array.length(data$prime);
            return Data_Array.mapWithIndex(function (i) {
                return function (val) {
                    return {
                        x: (function () {
                            var $30 = len <= 1;
                            if ($30) {
                                return Data_Int.toNumber(width) / 2.0;
                            };
                            return 2.0 + (Data_Int.toNumber(i) / Data_Int.toNumber(len - 1 | 0)) * (Data_Int.toNumber(width) - 2.0 * 2.0);
                        })(),
                        y: 2.0 + (1.0 - (val - minVal) / range) * (Data_Int.toNumber(height) - 2.0 * 2.0)
                    };
                };
            })(data$prime);
        };
    };
};

// ═══════════════════════════════════════════════════════════════════════════════
//                                                               // dot sparkline
// ═══════════════════════════════════════════════════════════════════════════════
// | Dot sparkline
var sparklineDot = function (config) {
    var points = normalizeData(config.data)(config.width)(config.height);
    var dots = map(function (p) {
        return Halogen_HTML_Elements.elementNS(Hydrogen_UI_Core.svgNS)("circle")([ Halogen_HTML_Properties.attr("cx")(show(p.x)), Halogen_HTML_Properties.attr("cy")(show(p.y)), Halogen_HTML_Properties.attr("r")("2"), Hydrogen_UI_Core.svgCls([ "fill-current" ]) ])([  ]);
    })(points);
    return Halogen_HTML_Elements.elementNS(Hydrogen_UI_Core.svgNS)("svg")([ Halogen_HTML_Properties.attr("viewBox")("0 0 " + (show1(config.width) + (" " + show1(config.height)))), Halogen_HTML_Properties.attr("width")(show1(config.width)), Halogen_HTML_Properties.attr("height")(show1(config.height)) ])(dots);
};

// | Sparkline with full props
var sparklineWithProps = function (props) {
    var points = normalizeData(props.data)(props.width)(props.height);
    var pathData = pointsToPath(points);
    var fillPathData = pointsToFillPath(points)(props.height);
    return Halogen_HTML_Elements.elementNS(Hydrogen_UI_Core.svgNS)("svg")([ Hydrogen_UI_Core.svgCls([ props.className ]), Halogen_HTML_Properties.attr("viewBox")("0 0 " + (show1(props.width) + (" " + show1(props.height)))), Halogen_HTML_Properties.attr("width")(show1(props.width)), Halogen_HTML_Properties.attr("height")(show1(props.height)), Halogen_HTML_Properties.attr("preserveAspectRatio")("none") ])(append1((function () {
        if (props.fillColor instanceof Data_Maybe.Just) {
            return [ Halogen_HTML_Elements.elementNS(Hydrogen_UI_Core.svgNS)("path")([ Halogen_HTML_Properties.attr("d")(fillPathData), Hydrogen_UI_Core.svgCls([ "fill-current", props.fillColor.value0 ]) ])([  ]) ];
        };
        if (props.fillColor instanceof Data_Maybe.Nothing) {
            return [  ];
        };
        throw new Error("Failed pattern match at Hydrogen.Chart.Sparkline (line 115, column 11 - line 123, column 26): " + [ props.fillColor.constructor.name ]);
    })())([ Halogen_HTML_Elements.elementNS(Hydrogen_UI_Core.svgNS)("path")([ Halogen_HTML_Properties.attr("d")(pathData), Halogen_HTML_Properties.attr("fill")("none"), Hydrogen_UI_Core.svgCls([ props.strokeColor ]), Halogen_HTML_Properties.attr("stroke-width")(show(props.strokeWidth)), Halogen_HTML_Properties.attr("stroke-linecap")("round"), Halogen_HTML_Properties.attr("stroke-linejoin")("round") ])([  ]) ]));
};

// | Default sparkline properties
var defaultProps = /* #__PURE__ */ (function () {
    return {
        data: [  ],
        width: 100,
        height: 24,
        strokeColor: "stroke-current",
        strokeWidth: 1.5,
        fillColor: Data_Maybe.Nothing.value,
        className: ""
    };
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                              // line sparkline
// ═══════════════════════════════════════════════════════════════════════════════
// | Simple sparkline with basic config
var sparkline = function (config) {
    return sparklineWithProps({
        strokeColor: defaultProps.strokeColor,
        strokeWidth: defaultProps.strokeWidth,
        fillColor: defaultProps.fillColor,
        className: defaultProps.className,
        data: config.data,
        width: config.width,
        height: config.height
    });
};
export {
    sparkline,
    sparklineWithProps,
    defaultProps,
    sparklineBar,
    sparklineDot
};
