// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
//                                         // hydrogen // schema // color // blend
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// | Blend modes and compositing operations.
// |
// | This module provides:
// | - **Blend Modes**: Photoshop-style blending (multiply, screen, overlay...)
// | - **Porter-Duff**: Alpha compositing operations
// | - **Mixing**: Color interpolation
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Hydrogen_Math_Core from "../Hydrogen.Math.Core/index.js";
import * as Hydrogen_Schema_Color_Channel from "../Hydrogen.Schema.Color.Channel/index.js";
import * as Hydrogen_Schema_Color_Opacity from "../Hydrogen.Schema.Color.Opacity/index.js";
import * as Hydrogen_Schema_Color_RGB from "../Hydrogen.Schema.Color.RGB/index.js";

// ═══════════════════════════════════════════════════════════════════════════════
//                                                     // porter-duff compositing
// ═══════════════════════════════════════════════════════════════════════════════
// | Porter-Duff compositing operations
var Clear = /* #__PURE__ */ (function () {
    function Clear() {

    };
    Clear.value = new Clear();
    return Clear;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                     // porter-duff compositing
// ═══════════════════════════════════════════════════════════════════════════════
// | Porter-Duff compositing operations
var Copy = /* #__PURE__ */ (function () {
    function Copy() {

    };
    Copy.value = new Copy();
    return Copy;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                     // porter-duff compositing
// ═══════════════════════════════════════════════════════════════════════════════
// | Porter-Duff compositing operations
var Destination = /* #__PURE__ */ (function () {
    function Destination() {

    };
    Destination.value = new Destination();
    return Destination;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                     // porter-duff compositing
// ═══════════════════════════════════════════════════════════════════════════════
// | Porter-Duff compositing operations
var SourceOver = /* #__PURE__ */ (function () {
    function SourceOver() {

    };
    SourceOver.value = new SourceOver();
    return SourceOver;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                     // porter-duff compositing
// ═══════════════════════════════════════════════════════════════════════════════
// | Porter-Duff compositing operations
var DestinationOver = /* #__PURE__ */ (function () {
    function DestinationOver() {

    };
    DestinationOver.value = new DestinationOver();
    return DestinationOver;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                     // porter-duff compositing
// ═══════════════════════════════════════════════════════════════════════════════
// | Porter-Duff compositing operations
var SourceIn = /* #__PURE__ */ (function () {
    function SourceIn() {

    };
    SourceIn.value = new SourceIn();
    return SourceIn;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                     // porter-duff compositing
// ═══════════════════════════════════════════════════════════════════════════════
// | Porter-Duff compositing operations
var DestinationIn = /* #__PURE__ */ (function () {
    function DestinationIn() {

    };
    DestinationIn.value = new DestinationIn();
    return DestinationIn;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                     // porter-duff compositing
// ═══════════════════════════════════════════════════════════════════════════════
// | Porter-Duff compositing operations
var SourceOut = /* #__PURE__ */ (function () {
    function SourceOut() {

    };
    SourceOut.value = new SourceOut();
    return SourceOut;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                     // porter-duff compositing
// ═══════════════════════════════════════════════════════════════════════════════
// | Porter-Duff compositing operations
var DestinationOut = /* #__PURE__ */ (function () {
    function DestinationOut() {

    };
    DestinationOut.value = new DestinationOut();
    return DestinationOut;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                     // porter-duff compositing
// ═══════════════════════════════════════════════════════════════════════════════
// | Porter-Duff compositing operations
var SourceAtop = /* #__PURE__ */ (function () {
    function SourceAtop() {

    };
    SourceAtop.value = new SourceAtop();
    return SourceAtop;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                     // porter-duff compositing
// ═══════════════════════════════════════════════════════════════════════════════
// | Porter-Duff compositing operations
var DestinationAtop = /* #__PURE__ */ (function () {
    function DestinationAtop() {

    };
    DestinationAtop.value = new DestinationAtop();
    return DestinationAtop;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                     // porter-duff compositing
// ═══════════════════════════════════════════════════════════════════════════════
// | Porter-Duff compositing operations
var Xor = /* #__PURE__ */ (function () {
    function Xor() {

    };
    Xor.value = new Xor();
    return Xor;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var Normal = /* #__PURE__ */ (function () {
    function Normal() {

    };
    Normal.value = new Normal();
    return Normal;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var Dissolve = /* #__PURE__ */ (function () {
    function Dissolve() {

    };
    Dissolve.value = new Dissolve();
    return Dissolve;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var Darken = /* #__PURE__ */ (function () {
    function Darken() {

    };
    Darken.value = new Darken();
    return Darken;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var Multiply = /* #__PURE__ */ (function () {
    function Multiply() {

    };
    Multiply.value = new Multiply();
    return Multiply;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var ColorBurn = /* #__PURE__ */ (function () {
    function ColorBurn() {

    };
    ColorBurn.value = new ColorBurn();
    return ColorBurn;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var LinearBurn = /* #__PURE__ */ (function () {
    function LinearBurn() {

    };
    LinearBurn.value = new LinearBurn();
    return LinearBurn;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var DarkerColor = /* #__PURE__ */ (function () {
    function DarkerColor() {

    };
    DarkerColor.value = new DarkerColor();
    return DarkerColor;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var Lighten = /* #__PURE__ */ (function () {
    function Lighten() {

    };
    Lighten.value = new Lighten();
    return Lighten;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var Screen = /* #__PURE__ */ (function () {
    function Screen() {

    };
    Screen.value = new Screen();
    return Screen;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var ColorDodge = /* #__PURE__ */ (function () {
    function ColorDodge() {

    };
    ColorDodge.value = new ColorDodge();
    return ColorDodge;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var LinearDodge = /* #__PURE__ */ (function () {
    function LinearDodge() {

    };
    LinearDodge.value = new LinearDodge();
    return LinearDodge;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var LighterColor = /* #__PURE__ */ (function () {
    function LighterColor() {

    };
    LighterColor.value = new LighterColor();
    return LighterColor;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var Overlay = /* #__PURE__ */ (function () {
    function Overlay() {

    };
    Overlay.value = new Overlay();
    return Overlay;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var SoftLight = /* #__PURE__ */ (function () {
    function SoftLight() {

    };
    SoftLight.value = new SoftLight();
    return SoftLight;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var HardLight = /* #__PURE__ */ (function () {
    function HardLight() {

    };
    HardLight.value = new HardLight();
    return HardLight;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var VividLight = /* #__PURE__ */ (function () {
    function VividLight() {

    };
    VividLight.value = new VividLight();
    return VividLight;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var LinearLight = /* #__PURE__ */ (function () {
    function LinearLight() {

    };
    LinearLight.value = new LinearLight();
    return LinearLight;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var PinLight = /* #__PURE__ */ (function () {
    function PinLight() {

    };
    PinLight.value = new PinLight();
    return PinLight;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var HardMix = /* #__PURE__ */ (function () {
    function HardMix() {

    };
    HardMix.value = new HardMix();
    return HardMix;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var Difference = /* #__PURE__ */ (function () {
    function Difference() {

    };
    Difference.value = new Difference();
    return Difference;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var Exclusion = /* #__PURE__ */ (function () {
    function Exclusion() {

    };
    Exclusion.value = new Exclusion();
    return Exclusion;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var Subtract = /* #__PURE__ */ (function () {
    function Subtract() {

    };
    Subtract.value = new Subtract();
    return Subtract;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // blend modes
// ═══════════════════════════════════════════════════════════════════════════════
// | Standard blend modes (Photoshop/CSS)
var Divide = /* #__PURE__ */ (function () {
    function Divide() {

    };
    Divide.value = new Divide();
    return Divide;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                     // helpers
// ═══════════════════════════════════════════════════════════════════════════════
// | Soft light helper function
var softLightD = function (x) {
    var $17 = x <= 0.25;
    if ($17) {
        return ((16.0 * x - 12.0) * x + 4.0) * x;
    };
    return Hydrogen_Math_Core.sqrt(x);
};
var eqCompositeOp = {
    eq: function (x) {
        return function (y) {
            if (x instanceof Clear && y instanceof Clear) {
                return true;
            };
            if (x instanceof Copy && y instanceof Copy) {
                return true;
            };
            if (x instanceof Destination && y instanceof Destination) {
                return true;
            };
            if (x instanceof SourceOver && y instanceof SourceOver) {
                return true;
            };
            if (x instanceof DestinationOver && y instanceof DestinationOver) {
                return true;
            };
            if (x instanceof SourceIn && y instanceof SourceIn) {
                return true;
            };
            if (x instanceof DestinationIn && y instanceof DestinationIn) {
                return true;
            };
            if (x instanceof SourceOut && y instanceof SourceOut) {
                return true;
            };
            if (x instanceof DestinationOut && y instanceof DestinationOut) {
                return true;
            };
            if (x instanceof SourceAtop && y instanceof SourceAtop) {
                return true;
            };
            if (x instanceof DestinationAtop && y instanceof DestinationAtop) {
                return true;
            };
            if (x instanceof Xor && y instanceof Xor) {
                return true;
            };
            return false;
        };
    }
};
var eqBlendMode = {
    eq: function (x) {
        return function (y) {
            if (x instanceof Normal && y instanceof Normal) {
                return true;
            };
            if (x instanceof Dissolve && y instanceof Dissolve) {
                return true;
            };
            if (x instanceof Darken && y instanceof Darken) {
                return true;
            };
            if (x instanceof Multiply && y instanceof Multiply) {
                return true;
            };
            if (x instanceof ColorBurn && y instanceof ColorBurn) {
                return true;
            };
            if (x instanceof LinearBurn && y instanceof LinearBurn) {
                return true;
            };
            if (x instanceof DarkerColor && y instanceof DarkerColor) {
                return true;
            };
            if (x instanceof Lighten && y instanceof Lighten) {
                return true;
            };
            if (x instanceof Screen && y instanceof Screen) {
                return true;
            };
            if (x instanceof ColorDodge && y instanceof ColorDodge) {
                return true;
            };
            if (x instanceof LinearDodge && y instanceof LinearDodge) {
                return true;
            };
            if (x instanceof LighterColor && y instanceof LighterColor) {
                return true;
            };
            if (x instanceof Overlay && y instanceof Overlay) {
                return true;
            };
            if (x instanceof SoftLight && y instanceof SoftLight) {
                return true;
            };
            if (x instanceof HardLight && y instanceof HardLight) {
                return true;
            };
            if (x instanceof VividLight && y instanceof VividLight) {
                return true;
            };
            if (x instanceof LinearLight && y instanceof LinearLight) {
                return true;
            };
            if (x instanceof PinLight && y instanceof PinLight) {
                return true;
            };
            if (x instanceof HardMix && y instanceof HardMix) {
                return true;
            };
            if (x instanceof Difference && y instanceof Difference) {
                return true;
            };
            if (x instanceof Exclusion && y instanceof Exclusion) {
                return true;
            };
            if (x instanceof Subtract && y instanceof Subtract) {
                return true;
            };
            if (x instanceof Divide && y instanceof Divide) {
                return true;
            };
            return false;
        };
    }
};

// | Convert composite op to CSS value
var compositeOpToCss = function (v) {
    if (v instanceof Clear) {
        return "clear";
    };
    if (v instanceof Copy) {
        return "copy";
    };
    if (v instanceof Destination) {
        return "destination";
    };
    if (v instanceof SourceOver) {
        return "source-over";
    };
    if (v instanceof DestinationOver) {
        return "destination-over";
    };
    if (v instanceof SourceIn) {
        return "source-in";
    };
    if (v instanceof DestinationIn) {
        return "destination-in";
    };
    if (v instanceof SourceOut) {
        return "source-out";
    };
    if (v instanceof DestinationOut) {
        return "destination-out";
    };
    if (v instanceof SourceAtop) {
        return "source-atop";
    };
    if (v instanceof DestinationAtop) {
        return "destination-atop";
    };
    if (v instanceof Xor) {
        return "xor";
    };
    throw new Error("Failed pattern match at Hydrogen.Schema.Color.Blend (line 289, column 20 - line 301, column 15): " + [ v.constructor.name ]);
};

// | Clamp to 0.0-1.0
var clampUnit = function (n) {
    if (n < 0.0) {
        return 0.0;
    };
    if (n > 1.0) {
        return 1.0;
    };
    if (Data_Boolean.otherwise) {
        return n;
    };
    throw new Error("Failed pattern match at Hydrogen.Schema.Color.Blend (line 322, column 1 - line 322, column 30): " + [ n.constructor.name ]);
};

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // color mixing
// ═══════════════════════════════════════════════════════════════════════════════
// | Mix two RGB colors (t=0 gives first, t=1 gives second)
var mixRGB = function (t) {
    return function (c1) {
        return function (c2) {
            var w = clampUnit(t);
            var r2 = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.red(c2));
            var r1 = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.red(c1));
            var mixVal = function (v1) {
                return function (v2) {
                    return Data_Int.round(Data_Int.toNumber(v1) * (1.0 - w) + Data_Int.toNumber(v2) * w);
                };
            };
            var g2 = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.green(c2));
            var g1 = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.green(c1));
            var b2 = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.blue(c2));
            var b1 = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.blue(c1));
            return Hydrogen_Schema_Color_RGB.rgb(mixVal(r1)(r2))(mixVal(g1)(g2))(mixVal(b1)(b2));
        };
    };
};

// | Linear interpolation between two RGB colors
var lerpRGB = mixRGB;

// | Mix two RGBA colors (t=0 gives first, t=1 gives second)
var mixRGBA = function (t) {
    return function (c1) {
        return function (c2) {
            var w = clampUnit(t);
            var rec2 = Hydrogen_Schema_Color_RGB.toRecordA(c2);
            var rec1 = Hydrogen_Schema_Color_RGB.toRecordA(c1);
            var mixVal = function (v1) {
                return function (v2) {
                    return Data_Int.round(Data_Int.toNumber(v1) * (1.0 - w) + Data_Int.toNumber(v2) * w);
                };
            };
            return Hydrogen_Schema_Color_RGB.rgba(mixVal(rec1.r)(rec2.r))(mixVal(rec1.g)(rec2.g))(mixVal(rec1.b)(rec2.b))(mixVal(rec1.a)(rec2.a));
        };
    };
};

// | Clamp to 0-255
var clamp8 = function (n) {
    if (n < 0) {
        return 0;
    };
    if (n > 255) {
        return 255;
    };
    if (Data_Boolean.otherwise) {
        return n;
    };
    throw new Error("Failed pattern match at Hydrogen.Schema.Color.Blend (line 315, column 1 - line 315, column 21): " + [ n.constructor.name ]);
};

// | Apply Porter-Duff compositing
var composite = function (op) {
    return function (src) {
        return function (dst) {
            var srcR = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.red(Hydrogen_Schema_Color_RGB.fromRGBA(src)));
            var srcG = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.green(Hydrogen_Schema_Color_RGB.fromRGBA(src)));
            var srcB = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.blue(Hydrogen_Schema_Color_RGB.fromRGBA(src)));
            var srcA = Hydrogen_Schema_Color_Opacity.toUnitInterval(Hydrogen_Schema_Color_RGB.alpha(src));
            var dstR = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.red(Hydrogen_Schema_Color_RGB.fromRGBA(dst)));
            var dstG = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.green(Hydrogen_Schema_Color_RGB.fromRGBA(dst)));
            var dstB = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.blue(Hydrogen_Schema_Color_RGB.fromRGBA(dst)));
            var dstA = Hydrogen_Schema_Color_Opacity.toUnitInterval(Hydrogen_Schema_Color_RGB.alpha(dst));
            
            // Porter-Duff factors: Fa for source, Fb for destination
var factors = (function () {
                if (op instanceof Clear) {
                    return {
                        fa: 0.0,
                        fb: 0.0
                    };
                };
                if (op instanceof Copy) {
                    return {
                        fa: 1.0,
                        fb: 0.0
                    };
                };
                if (op instanceof Destination) {
                    return {
                        fa: 0.0,
                        fb: 1.0
                    };
                };
                if (op instanceof SourceOver) {
                    return {
                        fa: 1.0,
                        fb: 1.0 - srcA
                    };
                };
                if (op instanceof DestinationOver) {
                    return {
                        fa: 1.0 - dstA,
                        fb: 1.0
                    };
                };
                if (op instanceof SourceIn) {
                    return {
                        fa: dstA,
                        fb: 0.0
                    };
                };
                if (op instanceof DestinationIn) {
                    return {
                        fa: 0.0,
                        fb: srcA
                    };
                };
                if (op instanceof SourceOut) {
                    return {
                        fa: 1.0 - dstA,
                        fb: 0.0
                    };
                };
                if (op instanceof DestinationOut) {
                    return {
                        fa: 0.0,
                        fb: 1.0 - srcA
                    };
                };
                if (op instanceof SourceAtop) {
                    return {
                        fa: dstA,
                        fb: 1.0 - srcA
                    };
                };
                if (op instanceof DestinationAtop) {
                    return {
                        fa: 1.0 - dstA,
                        fb: srcA
                    };
                };
                if (op instanceof Xor) {
                    return {
                        fa: 1.0 - dstA,
                        fb: 1.0 - srcA
                    };
                };
                throw new Error("Failed pattern match at Hydrogen.Schema.Color.Blend (line 191, column 15 - line 203, column 48): " + [ op.constructor.name ]);
            })();
            var resultA = srcA * factors.fa + dstA * factors.fb;
            var compChannel = function (srcC) {
                return function (dstC) {
                    var $26 = resultA === 0.0;
                    if ($26) {
                        return 0;
                    };
                    return clamp8(Data_Int.round((Data_Int.toNumber(srcC) * srcA * factors.fa + Data_Int.toNumber(dstC) * dstA * factors.fb) / resultA));
                };
            };
            return Hydrogen_Schema_Color_RGB.rgba(compChannel(srcR)(dstR))(compChannel(srcG)(dstG))(compChannel(srcB)(dstB))(Data_Int.round(resultA * 100.0));
        };
    };
};

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                  // css output
// ═══════════════════════════════════════════════════════════════════════════════
// | Convert blend mode to CSS mix-blend-mode value
var blendModeToCss = function (v) {
    if (v instanceof Normal) {
        return "normal";
    };
    if (v instanceof Dissolve) {
        return "normal";
    };
    if (v instanceof Darken) {
        return "darken";
    };
    if (v instanceof Multiply) {
        return "multiply";
    };
    if (v instanceof ColorBurn) {
        return "color-burn";
    };
    if (v instanceof LinearBurn) {
        return "color-burn";
    };
    if (v instanceof DarkerColor) {
        return "darken";
    };
    if (v instanceof Lighten) {
        return "lighten";
    };
    if (v instanceof Screen) {
        return "screen";
    };
    if (v instanceof ColorDodge) {
        return "color-dodge";
    };
    if (v instanceof LinearDodge) {
        return "color-dodge";
    };
    if (v instanceof LighterColor) {
        return "lighten";
    };
    if (v instanceof Overlay) {
        return "overlay";
    };
    if (v instanceof SoftLight) {
        return "soft-light";
    };
    if (v instanceof HardLight) {
        return "hard-light";
    };
    if (v instanceof VividLight) {
        return "hard-light";
    };
    if (v instanceof LinearLight) {
        return "hard-light";
    };
    if (v instanceof PinLight) {
        return "hard-light";
    };
    if (v instanceof HardMix) {
        return "hard-light";
    };
    if (v instanceof Difference) {
        return "difference";
    };
    if (v instanceof Exclusion) {
        return "exclusion";
    };
    if (v instanceof Subtract) {
        return "difference";
    };
    if (v instanceof Divide) {
        return "normal";
    };
    throw new Error("Failed pattern match at Hydrogen.Schema.Color.Blend (line 262, column 18 - line 285, column 21): " + [ v.constructor.name ]);
};
var showBlendMode = {
    show: blendModeToCss
};

// | Apply blend mode to a single channel (0-255)
var blendChannel = function (mode) {
    return function (base) {
        return function (top) {
            var t = Data_Int.toNumber(top) / 255.0;
            var b = Data_Int.toNumber(base) / 255.0;
            var result = (function () {
                if (mode instanceof Normal) {
                    return t;
                };
                if (mode instanceof Dissolve) {
                    return t;
                };
                if (mode instanceof Darken) {
                    return Hydrogen_Math_Core.min(b)(t);
                };
                if (mode instanceof Multiply) {
                    return b * t;
                };
                if (mode instanceof ColorBurn) {
                    var $29 = t === 0.0;
                    if ($29) {
                        return 0.0;
                    };
                    return 1.0 - Hydrogen_Math_Core.min(1.0)((1.0 - b) / t);
                };
                if (mode instanceof LinearBurn) {
                    return Hydrogen_Math_Core.max(0.0)((b + t) - 1.0);
                };
                if (mode instanceof DarkerColor) {
                    var $30 = b < t;
                    if ($30) {
                        return b;
                    };
                    return t;
                };
                if (mode instanceof Lighten) {
                    return Hydrogen_Math_Core.max(b)(t);
                };
                if (mode instanceof Screen) {
                    return 1.0 - (1.0 - b) * (1.0 - t);
                };
                if (mode instanceof ColorDodge) {
                    var $31 = t === 1.0;
                    if ($31) {
                        return 1.0;
                    };
                    return Hydrogen_Math_Core.min(1.0)(b / (1.0 - t));
                };
                if (mode instanceof LinearDodge) {
                    return Hydrogen_Math_Core.min(1.0)(b + t);
                };
                if (mode instanceof LighterColor) {
                    var $32 = b > t;
                    if ($32) {
                        return b;
                    };
                    return t;
                };
                if (mode instanceof Overlay) {
                    var $33 = b < 0.5;
                    if ($33) {
                        return 2.0 * b * t;
                    };
                    return 1.0 - 2.0 * (1.0 - b) * (1.0 - t);
                };
                if (mode instanceof SoftLight) {
                    var $34 = t < 0.5;
                    if ($34) {
                        return b - (1.0 - 2.0 * t) * b * (1.0 - b);
                    };
                    return b + (2.0 * t - 1.0) * (softLightD(b) - b);
                };
                if (mode instanceof HardLight) {
                    var $35 = t < 0.5;
                    if ($35) {
                        return 2.0 * b * t;
                    };
                    return 1.0 - 2.0 * (1.0 - b) * (1.0 - t);
                };
                if (mode instanceof VividLight) {
                    var $36 = t < 0.5;
                    if ($36) {
                        var $37 = t === 0.0;
                        if ($37) {
                            return 0.0;
                        };
                        return 1.0 - Hydrogen_Math_Core.min(1.0)((1.0 - b) / (2.0 * t));
                    };
                    var $38 = t === 1.0;
                    if ($38) {
                        return 1.0;
                    };
                    return Hydrogen_Math_Core.min(1.0)(b / (2.0 * (1.0 - t)));
                };
                if (mode instanceof LinearLight) {
                    return Hydrogen_Math_Core.max(0.0)(Hydrogen_Math_Core.min(1.0)((b + 2.0 * t) - 1.0));
                };
                if (mode instanceof PinLight) {
                    var $39 = t < 0.5;
                    if ($39) {
                        return Hydrogen_Math_Core.min(b)(2.0 * t);
                    };
                    return Hydrogen_Math_Core.max(b)(2.0 * t - 1.0);
                };
                if (mode instanceof HardMix) {
                    var $40 = b + t >= 1.0;
                    if ($40) {
                        return 1.0;
                    };
                    return 0.0;
                };
                if (mode instanceof Difference) {
                    return Hydrogen_Math_Core.abs(b - t);
                };
                if (mode instanceof Exclusion) {
                    return (b + t) - 2.0 * b * t;
                };
                if (mode instanceof Subtract) {
                    return Hydrogen_Math_Core.max(0.0)(b - t);
                };
                if (mode instanceof Divide) {
                    var $41 = t === 0.0;
                    if ($41) {
                        return 1.0;
                    };
                    return Hydrogen_Math_Core.min(1.0)(b / t);
                };
                throw new Error("Failed pattern match at Hydrogen.Schema.Color.Blend (line 121, column 14 - line 152, column 63): " + [ mode.constructor.name ]);
            })();
            return clamp8(Data_Int.round(result * 255.0));
        };
    };
};

// | Blend two RGBA colors using a blend mode
var blendRGBA = function (mode) {
    return function (base) {
        return function (top) {
            var topR = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.red(Hydrogen_Schema_Color_RGB.fromRGBA(top)));
            var topG = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.green(Hydrogen_Schema_Color_RGB.fromRGBA(top)));
            var topB = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.blue(Hydrogen_Schema_Color_RGB.fromRGBA(top)));
            var topA = Hydrogen_Schema_Color_Opacity.toUnitInterval(Hydrogen_Schema_Color_RGB.alpha(top));
            var baseR = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.red(Hydrogen_Schema_Color_RGB.fromRGBA(base)));
            
            // Apply blend mode to each channel
var blendedR = blendChannel(mode)(baseR)(topR);
            var baseG = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.green(Hydrogen_Schema_Color_RGB.fromRGBA(base)));
            var blendedG = blendChannel(mode)(baseG)(topG);
            var baseB = Hydrogen_Schema_Color_Channel.unwrap(Hydrogen_Schema_Color_RGB.blue(Hydrogen_Schema_Color_RGB.fromRGBA(base)));
            var blendedB = blendChannel(mode)(baseB)(topB);
            var baseA = Hydrogen_Schema_Color_Opacity.toUnitInterval(Hydrogen_Schema_Color_RGB.alpha(base));
            
            // Composite with alpha
var resultA = topA + baseA * (1.0 - topA);
            var mixWithAlpha = function (baseC) {
                return function (blendedC) {
                    var $42 = resultA === 0.0;
                    if ($42) {
                        return 0;
                    };
                    return Data_Int.round((Data_Int.toNumber(blendedC) * topA + Data_Int.toNumber(baseC) * baseA * (1.0 - topA)) / resultA);
                };
            };
            return Hydrogen_Schema_Color_RGB.rgba(mixWithAlpha(baseR)(blendedR))(mixWithAlpha(baseG)(blendedG))(mixWithAlpha(baseB)(blendedB))(Data_Int.round(resultA * 100.0));
        };
    };
};
export {
    Normal,
    Dissolve,
    Darken,
    Multiply,
    ColorBurn,
    LinearBurn,
    DarkerColor,
    Lighten,
    Screen,
    ColorDodge,
    LinearDodge,
    LighterColor,
    Overlay,
    SoftLight,
    HardLight,
    VividLight,
    LinearLight,
    PinLight,
    HardMix,
    Difference,
    Exclusion,
    Subtract,
    Divide,
    blendRGBA,
    blendChannel,
    Clear,
    Copy,
    Destination,
    SourceOver,
    DestinationOver,
    SourceIn,
    DestinationIn,
    SourceOut,
    DestinationOut,
    SourceAtop,
    DestinationAtop,
    Xor,
    composite,
    mixRGB,
    mixRGBA,
    lerpRGB,
    blendModeToCss,
    compositeOpToCss,
    eqBlendMode,
    showBlendMode,
    eqCompositeOp
};
