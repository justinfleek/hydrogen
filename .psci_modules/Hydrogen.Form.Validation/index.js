// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
//                                                     // hydrogen // validation
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// | Type-safe form validation
// |
// | Composable validation rules with error accumulation.
// |
// | ## Usage
// |
// | ```purescript
// | import Hydrogen.Form.Validation as V
// |
// | -- Single validators
// | V.required "Name is required"
// | V.minLength 3 "Name must be at least 3 characters"
// | V.email "Invalid email address"
// |
// | -- Compose validators
// | nameValidator = V.required "Required" <> V.minLength 3 "Too short"
// |
// | -- Run validation
// | case V.validate nameValidator "John" of
// |   V.Valid -> -- success
// |   V.Invalid errors -> -- show errors
// | ```
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Monoid from "../Data.Monoid/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_String_CodePoints from "../Data.String.CodePoints/index.js";
import * as Data_String_Common from "../Data.String.Common/index.js";
import * as Data_String_Regex from "../Data.String.Regex/index.js";
import * as Data_String_Regex_Flags from "../Data.String.Regex.Flags/index.js";
var show = /* #__PURE__ */ Data_Show.show(/* #__PURE__ */ Data_Show.showArray(Data_Show.showString));
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var eq = /* #__PURE__ */ Data_Eq.eq(/* #__PURE__ */ Data_Eq.eqArray(Data_Eq.eqString));

// ═══════════════════════════════════════════════════════════════════════════════
//                                                           // validation result
// ═══════════════════════════════════════════════════════════════════════════════
// | Result of validation
var Valid = /* #__PURE__ */ (function () {
    function Valid() {

    };
    Valid.value = new Valid();
    return Valid;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                           // validation result
// ═══════════════════════════════════════════════════════════════════════════════
// | Result of validation
var Invalid = /* #__PURE__ */ (function () {
    function Invalid(value0) {
        this.value0 = value0;
    };
    Invalid.create = function (value0) {
        return new Invalid(value0);
    };
    return Invalid;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                              // validator type
// ═══════════════════════════════════════════════════════════════════════════════
// | A validator is a function from value to result
var Validator = function (x) {
    return x;
};

// | Run a validator
var validate = function (v) {
    return v;
};

// | Run validation returning Either
var validateM = function (v) {
    return function (a) {
        var v1 = validate(v)(a);
        if (v1 instanceof Valid) {
            return new Data_Either.Right(a);
        };
        if (v1 instanceof Invalid) {
            return new Data_Either.Left(v1.value0);
        };
        throw new Error("Failed pattern match at Hydrogen.Form.Validation (line 127, column 17 - line 129, column 28): " + [ v1.constructor.name ]);
    };
};
var showValidationResult = {
    show: function (v) {
        if (v instanceof Valid) {
            return "Valid";
        };
        if (v instanceof Invalid) {
            return "(Invalid " + (show(v.value0) + ")");
        };
        throw new Error("Failed pattern match at Hydrogen.Form.Validation (line 81, column 1 - line 83, column 56): " + [ v.constructor.name ]);
    }
};
var semigroupValidationResult = {
    append: function (v) {
        return function (v1) {
            if (v instanceof Valid && v1 instanceof Valid) {
                return Valid.value;
            };
            if (v instanceof Valid && v1 instanceof Invalid) {
                return new Invalid(v1.value0);
            };
            if (v instanceof Invalid && v1 instanceof Valid) {
                return new Invalid(v.value0);
            };
            if (v instanceof Invalid && v1 instanceof Invalid) {
                return new Invalid(append1(v.value0)(v1.value0));
            };
            throw new Error("Failed pattern match at Hydrogen.Form.Validation (line 85, column 1 - line 89, column 68): " + [ v.constructor.name, v1.constructor.name ]);
        };
    }
};
var append2 = /* #__PURE__ */ Data_Semigroup.append(semigroupValidationResult);
var semigroupValidator = {
    append: function (v) {
        return function (v1) {
            return function (a) {
                return append2(v(a))(v1(a));
            };
        };
    }
};
var append3 = /* #__PURE__ */ Data_Semigroup.append(semigroupValidator);

// ═══════════════════════════════════════════════════════════════════════════════
//                                                           // common validators
// ═══════════════════════════════════════════════════════════════════════════════
// | Value must not be empty
var required = function (err) {
    return function (s) {
        var $54 = Data_String_Common["null"](Data_String_Common.trim(s));
        if ($54) {
            return new Invalid([ err ]);
        };
        return Valid.value;
    };
};

// | String must match regex pattern
var pattern = function (pat) {
    return function (err) {
        return function (s) {
            var v = Data_String_Regex.regex(pat)(Data_String_Regex_Flags.noFlags);
            if (v instanceof Data_Either.Left) {
                return Valid.value;
            };
            if (v instanceof Data_Either.Right) {
                var $57 = Data_String_Regex.test(v.value0)(s);
                if ($57) {
                    return Valid.value;
                };
                return new Invalid([ err ]);
            };
            throw new Error("Failed pattern match at Hydrogen.Form.Validation (line 159, column 3 - line 164, column 29): " + [ v.constructor.name ]);
        };
    };
};

// | Must be valid URL format
var url = function (err) {
    return pattern("^https?://")(err);
};

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // combinators
// ═══════════════════════════════════════════════════════════════════════════════
// | Make a validator optional (empty string passes)
var optional = function (v) {
    return function (s) {
        var $60 = Data_String_Common["null"](Data_String_Common.trim(s));
        if ($60) {
            return Valid.value;
        };
        return v(s);
    };
};

// | Must be one of allowed values
var oneOf = function (dictEq) {
    var elem = Data_Array.elem(dictEq);
    return function (allowed) {
        return function (err) {
            return function (a) {
                var $61 = elem(a)(allowed);
                if ($61) {
                    return Valid.value;
                };
                return new Invalid([ err ]);
            };
        };
    };
};

// | Must be numeric
var numeric = function (err) {
    return function (s) {
        var v = Data_Number.fromString(s);
        if (v instanceof Data_Maybe.Just) {
            return Valid.value;
        };
        if (v instanceof Data_Maybe.Nothing) {
            return new Invalid([ err ]);
        };
        throw new Error("Failed pattern match at Hydrogen.Form.Validation (line 177, column 3 - line 179, column 31): " + [ v.constructor.name ]);
    };
};

// | Must not equal value
var notEquals = function (dictEq) {
    var eq1 = Data_Eq.eq(dictEq);
    return function (forbidden) {
        return function (err) {
            return function (a) {
                var $64 = eq1(a)(forbidden);
                if ($64) {
                    return new Invalid([ err ]);
                };
                return Valid.value;
            };
        };
    };
};
var monoidValidator = {
    mempty: function (v) {
        return Valid.value;
    },
    Semigroup0: function () {
        return semigroupValidator;
    }
};
var mempty = /* #__PURE__ */ Data_Monoid.mempty(monoidValidator);

// | Only run validator when condition is true
var when = function (v) {
    return function (v1) {
        if (v) {
            return v1;
        };
        if (!v) {
            return mempty;
        };
        throw new Error("Failed pattern match at Hydrogen.Form.Validation (line 246, column 1 - line 246, column 56): " + [ v.constructor.name, v1.constructor.name ]);
    };
};

// | Only run validator when condition is false
var unless = function (cond) {
    return when(!cond);
};
var monoidValidationResult = /* #__PURE__ */ (function () {
    return {
        mempty: Valid.value,
        Semigroup0: function () {
            return semigroupValidationResult;
        }
    };
})();

// | String must have minimum length
var minLength = function (len) {
    return function (err) {
        return function (s) {
            var $67 = Data_String_CodePoints.length(s) < len;
            if ($67) {
                return new Invalid([ err ]);
            };
            return Valid.value;
        };
    };
};

// | Number must be at least minimum
var min = function (minVal) {
    return function (err) {
        return function (n) {
            var $68 = n < minVal;
            if ($68) {
                return new Invalid([ err ]);
            };
            return Valid.value;
        };
    };
};

// | String must not exceed maximum length
var maxLength = function (len) {
    return function (err) {
        return function (s) {
            var $69 = Data_String_CodePoints.length(s) > len;
            if ($69) {
                return new Invalid([ err ]);
            };
            return Valid.value;
        };
    };
};

// | Number must not exceed maximum
var max = function (maxVal) {
    return function (err) {
        return function (n) {
            var $70 = n > maxVal;
            if ($70) {
                return new Invalid([ err ]);
            };
            return Valid.value;
        };
    };
};

// | Number must be within range
var range = function (minVal) {
    return function (maxVal) {
        return function (err) {
            return append3(min(minVal)(err))(max(maxVal)(err));
        };
    };
};

// | Check if validation passed
var isValid = function (v) {
    if (v instanceof Valid) {
        return true;
    };
    return false;
};

// | Check if validation failed
var isInvalid = function ($82) {
    return !isValid($82);
};

// | Must be an integer
var integer = function (err) {
    return function (s) {
        var v = Data_Int.fromString(s);
        if (v instanceof Data_Maybe.Just) {
            return Valid.value;
        };
        if (v instanceof Data_Maybe.Nothing) {
            return new Invalid([ err ]);
        };
        throw new Error("Failed pattern match at Hydrogen.Form.Validation (line 184, column 3 - line 186, column 31): " + [ v.constructor.name ]);
    };
};

// | Extract error messages
var getErrors = function (v) {
    if (v instanceof Valid) {
        return [  ];
    };
    if (v instanceof Invalid) {
        return v.value0;
    };
    throw new Error("Failed pattern match at Hydrogen.Form.Validation (line 104, column 1 - line 104, column 46): " + [ v.constructor.name ]);
};

// | Must equal expected value
var equals = function (dictEq) {
    var eq1 = Data_Eq.eq(dictEq);
    return function (expected) {
        return function (err) {
            return function (a) {
                var $76 = eq1(a)(expected);
                if ($76) {
                    return Valid.value;
                };
                return new Invalid([ err ]);
            };
        };
    };
};
var eqValidationResult = {
    eq: function (x) {
        return function (y) {
            if (x instanceof Valid && y instanceof Valid) {
                return true;
            };
            if (x instanceof Invalid && y instanceof Invalid) {
                return eq(x.value0)(y.value0);
            };
            return false;
        };
    }
};

// | Must be valid email format
var email = function (err) {
    return pattern("^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$")(err);
};

// | Custom validation function
var custom = function (pred) {
    return function (err) {
        return function (a) {
            var $81 = pred(a);
            if ($81) {
                return Valid.value;
            };
            return new Invalid([ err ]);
        };
    };
};
export {
    Valid,
    Invalid,
    isValid,
    isInvalid,
    getErrors,
    validate,
    validateM,
    required,
    minLength,
    maxLength,
    pattern,
    email,
    url,
    numeric,
    integer,
    min,
    max,
    range,
    equals,
    notEquals,
    oneOf,
    custom,
    optional,
    when,
    unless,
    eqValidationResult,
    showValidationResult,
    semigroupValidationResult,
    monoidValidationResult,
    semigroupValidator,
    monoidValidator
};
