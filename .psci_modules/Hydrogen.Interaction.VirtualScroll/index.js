// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
//                                                  // hydrogen // virtual-scroll
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// | Virtual scroll - render only visible items for massive performance
// |
// | High-performance virtualized lists supporting 100k+ items at 60fps.
// | Supports fixed height, variable height (measured), grid mode, and
// | horizontal scrolling.
// |
// | ## Usage
// |
// | ```purescript
// | import Hydrogen.Interaction.VirtualScroll as VirtualScroll
// |
// | -- Fixed height items (fastest)
// | VirtualScroll.virtualList
// |   [ VirtualScroll.itemCount 10000
// |   , VirtualScroll.itemHeight (VirtualScroll.Fixed 48)
// |   , VirtualScroll.containerHeight 400
// |   , VirtualScroll.overscan 5
// |   , VirtualScroll.onScroll HandleScroll
// |   ]
// |   (\index -> HH.div_ [ HH.text $ "Item " <> show index ])
// |
// | -- Variable height items (measured)
// | VirtualScroll.virtualList
// |   [ VirtualScroll.itemCount 10000
// |   , VirtualScroll.itemHeight (VirtualScroll.Variable getItemHeight)
// |   , VirtualScroll.containerHeight 400
// |   ]
// |   renderItem
// |
// | -- Grid mode
// | VirtualScroll.virtualGrid
// |   [ VirtualScroll.rowCount 1000
// |   , VirtualScroll.columnCount 10
// |   , VirtualScroll.cellWidth 100
// |   , VirtualScroll.cellHeight 100
// |   ]
// |   (\row col -> renderCell row col)
// | ```
import * as $foreign from "./foreign.js";
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_EuclideanRing from "../Data.EuclideanRing/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect_Ref from "../Effect.Ref/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_HTML_Properties from "../Halogen.HTML.Properties/index.js";
import * as Hydrogen_UI_Core from "../Hydrogen.UI.Core/index.js";
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var div = /* #__PURE__ */ Data_EuclideanRing.div(Data_EuclideanRing.euclideanRingInt);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordInt);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordInt);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var bind1 = /* #__PURE__ */ Control_Bind.bind(Control_Bind.bindArray);
var pure1 = /* #__PURE__ */ Control_Applicative.pure(Control_Applicative.applicativeArray);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);

// | Scroll direction
var Vertical = /* #__PURE__ */ (function () {
    function Vertical() {

    };
    Vertical.value = new Vertical();
    return Vertical;
})();

// | Scroll direction
var Horizontal = /* #__PURE__ */ (function () {
    function Horizontal() {

    };
    Horizontal.value = new Horizontal();
    return Horizontal;
})();

// | Scroll direction
var Both = /* #__PURE__ */ (function () {
    function Both() {

    };
    Both.value = new Both();
    return Both;
})();

// | Reference to virtual scroll instance for imperative operations
var VirtualScrollRef = function (x) {
    return x;
};

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                       // types
// ═══════════════════════════════════════════════════════════════════════════════
// | Item height configuration
var Fixed = /* #__PURE__ */ (function () {
    function Fixed(value0) {
        this.value0 = value0;
    };
    Fixed.create = function (value0) {
        return new Fixed(value0);
    };
    return Fixed;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                       // types
// ═══════════════════════════════════════════════════════════════════════════════
// | Item height configuration
var Variable = /* #__PURE__ */ (function () {
    function Variable(value0) {
        this.value0 = value0;
    };
    Variable.create = function (value0) {
        return new Variable(value0);
    };
    return Variable;
})();

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                       // types
// ═══════════════════════════════════════════════════════════════════════════════
// | Item height configuration
var Dynamic = /* #__PURE__ */ (function () {
    function Dynamic() {

    };
    Dynamic.value = new Dynamic();
    return Dynamic;
})();

// | Sum heights for variable height calculation
var sumHeights = function (f) {
    return function (start) {
        return function (end) {
            if (start >= end) {
                return 0.0;
            };
            if (Data_Boolean.otherwise) {
                return f(start) + sumHeights(f)(start + 1 | 0)(end);
            };
            throw new Error("Failed pattern match at Hydrogen.Interaction.VirtualScroll (line 350, column 1 - line 350, column 54): " + [ f.constructor.name, start.constructor.name, end.constructor.name ]);
        };
    };
};

// | Set number of sticky (frozen) header rows
var stickyRows = function (n) {
    return function (props) {
        return {
            rowCount: props.rowCount,
            columnCount: props.columnCount,
            cellWidth: props.cellWidth,
            cellHeight: props.cellHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscanRows: props.overscanRows,
            overscanColumns: props.overscanColumns,
            stickyColumns: props.stickyColumns,
            onScroll: props.onScroll,
            className: props.className,
            stickyRows: n
        };
    };
};

// | Set number of sticky (frozen) header columns
var stickyColumns = function (n) {
    return function (props) {
        return {
            rowCount: props.rowCount,
            columnCount: props.columnCount,
            cellWidth: props.cellWidth,
            cellHeight: props.cellHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscanRows: props.overscanRows,
            overscanColumns: props.overscanColumns,
            stickyRows: props.stickyRows,
            onScroll: props.onScroll,
            className: props.className,
            stickyColumns: n
        };
    };
};

// | Scroll to specific index
var scrollToIndex = function (idx) {
    return function (props) {
        return {
            itemCount: props.itemCount,
            itemHeight: props.itemHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscan: props.overscan,
            horizontal: props.horizontal,
            onScroll: props.onScroll,
            onVisibleRangeChange: props.onVisibleRangeChange,
            className: props.className,
            estimatedItemSize: props.estimatedItemSize,
            scrollToIndex: new Data_Maybe.Just(idx)
        };
    };
};

// | Scroll to a specific pixel offset
var scrollTo = function (v) {
    return function (offset) {
        return function __do() {
            Effect_Ref.write(offset)(v.scrollOffset)();
            var maybeContainer = Effect_Ref.read(v.containerRef)();
            if (maybeContainer instanceof Data_Maybe.Just) {
                return $foreign.scrollToImpl(maybeContainer.value0)(offset)();
            };
            if (maybeContainer instanceof Data_Maybe.Nothing) {
                return Data_Unit.unit;
            };
            throw new Error("Failed pattern match at Hydrogen.Interaction.VirtualScroll (line 575, column 3 - line 577, column 25): " + [ maybeContainer.constructor.name ]);
        };
    };
};

// | Set row count
var rowCount = function (n) {
    return function (props) {
        return {
            columnCount: props.columnCount,
            cellWidth: props.cellWidth,
            cellHeight: props.cellHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscanRows: props.overscanRows,
            overscanColumns: props.overscanColumns,
            stickyRows: props.stickyRows,
            stickyColumns: props.stickyColumns,
            onScroll: props.onScroll,
            className: props.className,
            rowCount: n
        };
    };
};

// | Set overscan count (extra items to render above/below viewport)
var overscan = function (n) {
    return function (props) {
        return {
            itemCount: props.itemCount,
            itemHeight: props.itemHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            horizontal: props.horizontal,
            scrollToIndex: props.scrollToIndex,
            onScroll: props.onScroll,
            onVisibleRangeChange: props.onVisibleRangeChange,
            className: props.className,
            estimatedItemSize: props.estimatedItemSize,
            overscan: n
        };
    };
};

// | Callback when visible range changes
var onVisibleRangeChange = function (handler) {
    return function (props) {
        return {
            itemCount: props.itemCount,
            itemHeight: props.itemHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscan: props.overscan,
            horizontal: props.horizontal,
            scrollToIndex: props.scrollToIndex,
            onScroll: props.onScroll,
            className: props.className,
            estimatedItemSize: props.estimatedItemSize,
            onVisibleRangeChange: new Data_Maybe.Just(handler)
        };
    };
};

// | Callback when scroll position changes
var onScroll = function (handler) {
    return function (props) {
        return {
            itemCount: props.itemCount,
            itemHeight: props.itemHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscan: props.overscan,
            horizontal: props.horizontal,
            scrollToIndex: props.scrollToIndex,
            onVisibleRangeChange: props.onVisibleRangeChange,
            className: props.className,
            estimatedItemSize: props.estimatedItemSize,
            onScroll: new Data_Maybe.Just(handler)
        };
    };
};

// | Measure an item's actual height (for Dynamic mode)
var measureItem = function (v) {
    return function (index) {
        var updateAt = function (idx) {
            return function (val) {
                return function (arr) {
                    var padded = (function () {
                        var $57 = Data_Array.length(arr) > idx;
                        if ($57) {
                            return arr;
                        };
                        return append(arr)(Data_Array.replicate((idx - Data_Array.length(arr) | 0) + 1 | 0)(0.0));
                    })();
                    return Data_Maybe.fromMaybe(padded)(Data_Array.updateAt(idx)(val)(padded));
                };
            };
        };
        return function __do() {
            var maybeContainer = Effect_Ref.read(v.containerRef)();
            if (maybeContainer instanceof Data_Maybe.Just) {
                var height = $foreign.measureElementImpl(maybeContainer.value0)(index)();
                var heights = Effect_Ref.read(v.measuredHeights)();
                var newHeights = updateAt(index)(height)(heights);
                Effect_Ref.write(newHeights)(v.measuredHeights)();
                return height;
            };
            if (maybeContainer instanceof Data_Maybe.Nothing) {
                return 0.0;
            };
            throw new Error("Failed pattern match at Hydrogen.Interaction.VirtualScroll (line 604, column 3 - line 612, column 24): " + [ maybeContainer.constructor.name ]);
        };
    };
};

// | Set item height mode
var itemHeight = function (h) {
    return function (props) {
        return {
            itemCount: props.itemCount,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscan: props.overscan,
            horizontal: props.horizontal,
            scrollToIndex: props.scrollToIndex,
            onScroll: props.onScroll,
            onVisibleRangeChange: props.onVisibleRangeChange,
            className: props.className,
            estimatedItemSize: props.estimatedItemSize,
            itemHeight: h
        };
    };
};

// | Set total number of items
var itemCount = function (n) {
    return function (props) {
        return {
            itemHeight: props.itemHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscan: props.overscan,
            horizontal: props.horizontal,
            scrollToIndex: props.scrollToIndex,
            onScroll: props.onScroll,
            onVisibleRangeChange: props.onVisibleRangeChange,
            className: props.className,
            estimatedItemSize: props.estimatedItemSize,
            itemCount: n
        };
    };
};

// | Enable horizontal scrolling
var horizontal = function (h) {
    return function (props) {
        return {
            itemCount: props.itemCount,
            itemHeight: props.itemHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscan: props.overscan,
            scrollToIndex: props.scrollToIndex,
            onScroll: props.onScroll,
            onVisibleRangeChange: props.onVisibleRangeChange,
            className: props.className,
            estimatedItemSize: props.estimatedItemSize,
            horizontal: h
        };
    };
};

// | Callback when grid scrolls
var gridOnScroll = function (handler) {
    return function (props) {
        return {
            rowCount: props.rowCount,
            columnCount: props.columnCount,
            cellWidth: props.cellWidth,
            cellHeight: props.cellHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscanRows: props.overscanRows,
            overscanColumns: props.overscanColumns,
            stickyRows: props.stickyRows,
            stickyColumns: props.stickyColumns,
            className: props.className,
            onScroll: new Data_Maybe.Just(handler)
        };
    };
};

// | Add custom class to grid
var gridClassName = function (c) {
    return function (props) {
        return {
            rowCount: props.rowCount,
            columnCount: props.columnCount,
            cellWidth: props.cellWidth,
            cellHeight: props.cellHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscanRows: props.overscanRows,
            overscanColumns: props.overscanColumns,
            stickyRows: props.stickyRows,
            stickyColumns: props.stickyColumns,
            onScroll: props.onScroll,
            className: props.className + (" " + c)
        };
    };
};

// | Get current scroll offset
var getScrollOffset = function (v) {
    return Effect_Ref.read(v.scrollOffset);
};

// | Get estimated total width (for horizontal scrolling)
var getEstimatedTotalWidth = function (opts) {
    return Data_Int.toNumber(opts.itemCount) * opts.itemWidth;
};

// | Get estimated total height of all items
var getEstimatedTotalHeight = function (opts) {
    if (opts.itemHeight instanceof Fixed) {
        return Data_Int.toNumber(opts.itemCount) * opts.itemHeight.value0;
    };
    if (opts.itemHeight instanceof Variable) {
        return sumHeights(opts.itemHeight.value0)(0)(opts.itemCount);
    };
    if (opts.itemHeight instanceof Dynamic) {
        return Data_Int.toNumber(opts.itemCount) * opts.estimatedItemSize;
    };
    throw new Error("Failed pattern match at Hydrogen.Interaction.VirtualScroll (line 374, column 32 - line 377, column 62): " + [ opts.itemHeight.constructor.name ]);
};
var eqScrollDirection = {
    eq: function (x) {
        return function (y) {
            if (x instanceof Vertical && y instanceof Vertical) {
                return true;
            };
            if (x instanceof Horizontal && y instanceof Horizontal) {
                return true;
            };
            if (x instanceof Both && y instanceof Both) {
                return true;
            };
            return false;
        };
    }
};
var defaultProps = /* #__PURE__ */ (function () {
    return {
        itemCount: 0,
        itemHeight: new Fixed(40.0),
        containerHeight: 400.0,
        containerWidth: 400.0,
        overscan: 3,
        horizontal: false,
        scrollToIndex: Data_Maybe.Nothing.value,
        onScroll: Data_Maybe.Nothing.value,
        onVisibleRangeChange: Data_Maybe.Nothing.value,
        className: "",
        estimatedItemSize: 40.0
    };
})();
var defaultGridProps = /* #__PURE__ */ (function () {
    return {
        rowCount: 0,
        columnCount: 0,
        cellWidth: 100.0,
        cellHeight: 40.0,
        containerHeight: 400.0,
        containerWidth: 600.0,
        overscanRows: 2,
        overscanColumns: 2,
        stickyRows: 0,
        stickyColumns: 0,
        onScroll: Data_Maybe.Nothing.value,
        className: ""
    };
})();

// | Create a virtual scroll ref for imperative operations
var createVirtualScrollRef = function __do() {
    var scrollOffset = Effect_Ref["new"](0.0)();
    var measuredHeights = Effect_Ref["new"]([  ])();
    var containerRef = Effect_Ref["new"](Data_Maybe.Nothing.value)();
    return {
        scrollOffset: scrollOffset,
        measuredHeights: measuredHeights,
        containerRef: containerRef
    };
};

// | Set container width in pixels (for horizontal scrolling)
var containerWidth = function (w) {
    return function (props) {
        return {
            itemCount: props.itemCount,
            itemHeight: props.itemHeight,
            containerHeight: props.containerHeight,
            overscan: props.overscan,
            horizontal: props.horizontal,
            scrollToIndex: props.scrollToIndex,
            onScroll: props.onScroll,
            onVisibleRangeChange: props.onVisibleRangeChange,
            className: props.className,
            estimatedItemSize: props.estimatedItemSize,
            containerWidth: w
        };
    };
};

// | Set container height in pixels
var containerHeight = function (h) {
    return function (props) {
        return {
            itemCount: props.itemCount,
            itemHeight: props.itemHeight,
            containerWidth: props.containerWidth,
            overscan: props.overscan,
            horizontal: props.horizontal,
            scrollToIndex: props.scrollToIndex,
            onScroll: props.onScroll,
            onVisibleRangeChange: props.onVisibleRangeChange,
            className: props.className,
            estimatedItemSize: props.estimatedItemSize,
            containerHeight: h
        };
    };
};

// | Set column count
var columnCount = function (n) {
    return function (props) {
        return {
            rowCount: props.rowCount,
            cellWidth: props.cellWidth,
            cellHeight: props.cellHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscanRows: props.overscanRows,
            overscanColumns: props.overscanColumns,
            stickyRows: props.stickyRows,
            stickyColumns: props.stickyColumns,
            onScroll: props.onScroll,
            className: props.className,
            columnCount: n
        };
    };
};

// | Add custom class
var className = function (c) {
    return function (props) {
        return {
            itemCount: props.itemCount,
            itemHeight: props.itemHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscan: props.overscan,
            horizontal: props.horizontal,
            scrollToIndex: props.scrollToIndex,
            onScroll: props.onScroll,
            onVisibleRangeChange: props.onVisibleRangeChange,
            estimatedItemSize: props.estimatedItemSize,
            className: props.className + (" " + c)
        };
    };
};

// | Set cell width
var cellWidth = function (w) {
    return function (props) {
        return {
            rowCount: props.rowCount,
            columnCount: props.columnCount,
            cellHeight: props.cellHeight,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscanRows: props.overscanRows,
            overscanColumns: props.overscanColumns,
            stickyRows: props.stickyRows,
            stickyColumns: props.stickyColumns,
            onScroll: props.onScroll,
            className: props.className,
            cellWidth: w
        };
    };
};

// | Set cell height
var cellHeight = function (h) {
    return function (props) {
        return {
            rowCount: props.rowCount,
            columnCount: props.columnCount,
            cellWidth: props.cellWidth,
            containerHeight: props.containerHeight,
            containerWidth: props.containerWidth,
            overscanRows: props.overscanRows,
            overscanColumns: props.overscanColumns,
            stickyRows: props.stickyRows,
            stickyColumns: props.stickyColumns,
            onScroll: props.onScroll,
            className: props.className,
            cellHeight: h
        };
    };
};

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                 // calculations
// ═══════════════════════════════════════════════════════════════════════════════
// | Calculate which items are visible given scroll offset
var calculateVisibleRange = function (opts) {
    var getItemSize = function (idx) {
        if (opts.itemHeight instanceof Fixed) {
            return opts.itemHeight.value0;
        };
        if (opts.itemHeight instanceof Variable) {
            return opts.itemHeight.value0(idx);
        };
        if (opts.itemHeight instanceof Dynamic) {
            return opts.estimatedItemSize;
        };
        throw new Error("Failed pattern match at Hydrogen.Interaction.VirtualScroll (line 316, column 23 - line 319, column 40): " + [ opts.itemHeight.constructor.name ]);
    };
    var getItemOffset = function (idx) {
        if (opts.itemHeight instanceof Fixed) {
            return Data_Int.toNumber(idx) * opts.itemHeight.value0;
        };
        if (opts.itemHeight instanceof Variable) {
            return sumHeights(opts.itemHeight.value0)(0)(idx);
        };
        if (opts.itemHeight instanceof Dynamic) {
            return Data_Int.toNumber(idx) * opts.estimatedItemSize;
        };
        throw new Error("Failed pattern match at Hydrogen.Interaction.VirtualScroll (line 310, column 25 - line 313, column 55): " + [ opts.itemHeight.constructor.name ]);
    };
    
    // Binary search for start index
var findStartIndex = function ($copy_low) {
        return function ($copy_high) {
            var $tco_var_low = $copy_low;
            var $tco_done = false;
            var $tco_result;
            function $tco_loop(low, high) {
                if (low >= high) {
                    $tco_done = true;
                    return low;
                };
                if (Data_Boolean.otherwise) {
                    var mid = div(low + high | 0)(2);
                    var offset = getItemOffset(mid);
                    var $74 = offset < opts.scrollOffset;
                    if ($74) {
                        $tco_var_low = mid + 1 | 0;
                        $copy_high = high;
                        return;
                    };
                    $tco_var_low = low;
                    $copy_high = mid;
                    return;
                };
                throw new Error("Failed pattern match at Hydrogen.Interaction.VirtualScroll (line 322, column 5 - line 322, column 40): " + [ low.constructor.name, high.constructor.name ]);
            };
            while (!$tco_done) {
                $tco_result = $tco_loop($tco_var_low, $copy_high);
            };
            return $tco_result;
        };
    };
    var rawStart = findStartIndex(0)(opts.itemCount);
    var startIndex = max(0)(rawStart);
    var overscanStart = max(0)(startIndex - opts.overscan | 0);
    
    // Find end index by scanning forward
var findEndIndex = function ($copy_idx) {
        return function ($copy_accOffset) {
            var $tco_var_idx = $copy_idx;
            var $tco_done1 = false;
            var $tco_result;
            function $tco_loop(idx, accOffset) {
                if (idx >= opts.itemCount) {
                    $tco_done1 = true;
                    return opts.itemCount - 1 | 0;
                };
                if (accOffset > opts.scrollOffset + opts.containerSize) {
                    $tco_done1 = true;
                    return idx;
                };
                if (Data_Boolean.otherwise) {
                    $tco_var_idx = idx + 1 | 0;
                    $copy_accOffset = accOffset + getItemSize(idx);
                    return;
                };
                throw new Error("Failed pattern match at Hydrogen.Interaction.VirtualScroll (line 333, column 5 - line 333, column 41): " + [ idx.constructor.name, accOffset.constructor.name ]);
            };
            while (!$tco_done1) {
                $tco_result = $tco_loop($tco_var_idx, $copy_accOffset);
            };
            return $tco_result;
        };
    };
    var rawEnd = findEndIndex(rawStart)(getItemOffset(rawStart));
    var endIndex = min(opts.itemCount - 1 | 0)(rawEnd);
    var overscanEnd = min(opts.itemCount - 1 | 0)(endIndex + opts.overscan | 0);
    return {
        startIndex: startIndex,
        endIndex: endIndex,
        overscanStart: overscanStart,
        overscanEnd: overscanEnd
    };
};

// | Virtualized grid component
// |
// | Virtualizes both rows AND columns for massive data grids.
// | Supports sticky headers and frozen columns.
var virtualGrid = function (propMods) {
    return function (renderCell) {
        return function (scrollPos) {
            var props = Data_Array.foldl(function (p) {
                return function (f) {
                    return f(p);
                };
            })(defaultGridProps)(propMods);
            
            // Calculate visible row range
var rowRange = calculateVisibleRange({
                scrollOffset: scrollPos.scrollY,
                containerSize: props.containerHeight,
                itemCount: props.rowCount,
                itemHeight: new Fixed(props.cellHeight),
                overscan: props.overscanRows,
                estimatedItemSize: props.cellHeight
            });
            var totalHeight = Data_Int.toNumber(props.rowCount) * props.cellHeight;
            var totalWidth = Data_Int.toNumber(props.columnCount) * props.cellWidth;
            var innerStyle = "position: relative;" + (" width: " + (show(totalWidth) + ("px;" + (" height: " + (show(totalHeight) + "px;")))));
            var containerStyle = "position: relative; overflow: auto; will-change: transform;" + (" width: " + (show(props.containerWidth) + ("px;" + (" height: " + (show(props.containerHeight) + "px;")))));
            
            // Calculate visible column range
var colRange = calculateVisibleRange({
                scrollOffset: scrollPos.scrollX,
                containerSize: props.containerWidth,
                itemCount: props.columnCount,
                itemHeight: new Fixed(props.cellWidth),
                overscan: props.overscanColumns,
                estimatedItemSize: props.cellWidth
            });
            
            // Generate visible cells
var visibleCells = bind1(Data_Array.range(rowRange.overscanStart)(rowRange.overscanEnd))(function (rowIdx) {
                return bind1(Data_Array.range(colRange.overscanStart)(colRange.overscanEnd))(function (colIdx) {
                    var top = Data_Int.toNumber(rowIdx) * props.cellHeight;
                    var position = (function () {
                        var $77 = rowIdx < props.stickyRows && colIdx < props.stickyColumns;
                        if ($77) {
                            return "position: sticky; top: 0; left: 0;";
                        };
                        var $78 = rowIdx < props.stickyRows;
                        if ($78) {
                            return "position: sticky; top: 0;";
                        };
                        var $79 = colIdx < props.stickyColumns;
                        if ($79) {
                            return "position: sticky; left: 0;";
                        };
                        return "position: absolute;";
                    })();
                    var left = Data_Int.toNumber(colIdx) * props.cellWidth;
                    var isSticky = rowIdx < props.stickyRows || colIdx < props.stickyColumns;
                    var zIndex = (function () {
                        if (isSticky) {
                            return "z-index: 10;";
                        };
                        return "";
                    })();
                    var style = position + (" top: " + (show(top) + ("px;" + (" left: " + (show(left) + ("px;" + (" width: " + (show(props.cellWidth) + ("px;" + (" height: " + (show(props.cellHeight) + ("px;" + zIndex))))))))))));
                    return pure1(Halogen_HTML_Elements.div([ Halogen_HTML_Properties.style(style), Halogen_HTML_Properties.attr("data-row")(show1(rowIdx)), Halogen_HTML_Properties.attr("data-col")(show1(colIdx)) ])([ renderCell(rowIdx)(colIdx) ]));
                });
            });
            return Halogen_HTML_Elements.div([ Hydrogen_UI_Core.cls([ "virtual-grid-container", props.className ]), Halogen_HTML_Properties.style(containerStyle) ])([ Halogen_HTML_Elements.div([ Hydrogen_UI_Core.cls([ "virtual-grid-inner" ]), Halogen_HTML_Properties.style(innerStyle) ])(visibleCells) ]);
        };
    };
};

// | Calculate scroll position for a given index
var calculateScrollPosition = function (opts) {
    if (opts.itemHeight instanceof Fixed) {
        return Data_Int.toNumber(opts.index) * opts.itemHeight.value0;
    };
    if (opts.itemHeight instanceof Variable) {
        return sumHeights(opts.itemHeight.value0)(0)(opts.index);
    };
    if (opts.itemHeight instanceof Dynamic) {
        return Data_Int.toNumber(opts.index) * opts.estimatedItemSize;
    };
    throw new Error("Failed pattern match at Hydrogen.Interaction.VirtualScroll (line 362, column 32 - line 365, column 58): " + [ opts.itemHeight.constructor.name ]);
};

// | Scroll to bring a specific item index into view
var scrollToItem = function (ref) {
    return function (opts) {
        var offset = calculateScrollPosition({
            index: opts.index,
            itemHeight: opts.itemHeight,
            estimatedItemSize: opts.estimatedItemSize
        });
        return scrollTo(ref)(offset);
    };
};

// ═══════════════════════════════════════════════════════════════════════════════
//                                                                  // components
// ═══════════════════════════════════════════════════════════════════════════════
// | Virtualized list component
// |
// | Renders only visible items plus overscan buffer for 60fps scrolling
// | with any number of items.
var virtualList = function (propMods) {
    return function (renderItem) {
        return function (scrollOffset) {
            var props = Data_Array.foldl(function (p) {
                return function (f) {
                    return f(p);
                };
            })(defaultProps)(propMods);
            var totalHeight = getEstimatedTotalHeight({
                itemCount: props.itemCount,
                itemHeight: props.itemHeight,
                estimatedItemSize: props.estimatedItemSize
            });
            var visibleRange = calculateVisibleRange({
                scrollOffset: scrollOffset,
                containerSize: (function () {
                    if (props.horizontal) {
                        return props.containerWidth;
                    };
                    return props.containerHeight;
                })(),
                itemCount: props.itemCount,
                itemHeight: props.itemHeight,
                overscan: props.overscan,
                estimatedItemSize: props.estimatedItemSize
            });
            
            // Generate visible items with positioning
var visibleItems = map(function (idx) {
                var offset = calculateScrollPosition({
                    index: idx,
                    itemHeight: props.itemHeight,
                    estimatedItemSize: props.estimatedItemSize
                });
                var height = (function () {
                    if (props.itemHeight instanceof Fixed) {
                        return props.itemHeight.value0;
                    };
                    if (props.itemHeight instanceof Variable) {
                        return props.itemHeight.value0(idx);
                    };
                    if (props.itemHeight instanceof Dynamic) {
                        return props.estimatedItemSize;
                    };
                    throw new Error("Failed pattern match at Hydrogen.Interaction.VirtualScroll (line 428, column 18 - line 431, column 45): " + [ props.itemHeight.constructor.name ]);
                })();
                var style = (function () {
                    if (props.horizontal) {
                        return "position: absolute; left: " + (show(offset) + ("px; width: " + (show(height) + "px; height: 100%;")));
                    };
                    return "position: absolute; top: " + (show(offset) + ("px; height: " + (show(height) + "px; width: 100%;")));
                })();
                return Halogen_HTML_Elements.div([ Halogen_HTML_Properties.style(style), Halogen_HTML_Properties.attr("data-index")(show1(idx)) ])([ renderItem(idx) ]);
            })(Data_Array.range(visibleRange.overscanStart)(visibleRange.overscanEnd));
            var innerStyle = "position: relative;" + (function () {
                if (props.horizontal) {
                    return " width: " + (show(totalHeight) + "px; height: 100%;");
                };
                return " height: " + (show(totalHeight) + "px; width: 100%;");
            })();
            var containerStyle = "position: relative; overflow: auto; will-change: transform;" + (function () {
                if (props.horizontal) {
                    return " width: " + (show(props.containerWidth) + "px; height: 100%;");
                };
                return " height: " + (show(props.containerHeight) + "px; width: 100%;");
            })();
            return Halogen_HTML_Elements.div([ Hydrogen_UI_Core.cls([ "virtual-scroll-container", props.className ]), Halogen_HTML_Properties.style(containerStyle) ])([ Halogen_HTML_Elements.div([ Hydrogen_UI_Core.cls([ "virtual-scroll-inner" ]), Halogen_HTML_Properties.style(innerStyle) ])(visibleItems) ]);
        };
    };
};
export {
    virtualList,
    virtualGrid,
    Fixed,
    Variable,
    Dynamic,
    Vertical,
    Horizontal,
    Both,
    itemCount,
    itemHeight,
    containerHeight,
    containerWidth,
    overscan,
    horizontal,
    onScroll,
    onVisibleRangeChange,
    scrollToIndex,
    className,
    rowCount,
    columnCount,
    cellWidth,
    cellHeight,
    stickyRows,
    stickyColumns,
    gridOnScroll,
    gridClassName,
    calculateVisibleRange,
    calculateScrollPosition,
    getEstimatedTotalHeight,
    getEstimatedTotalWidth,
    createVirtualScrollRef,
    scrollTo,
    scrollToItem,
    getScrollOffset,
    measureItem,
    eqScrollDirection
};
